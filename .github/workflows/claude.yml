name: Claude Code

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened, assigned]
  pull_request_review:
    types: [submitted]

jobs:
  claude:
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review' && contains(github.event.review.body, '@claude')) ||
      (github.event_name == 'issues' && (contains(github.event.issue.body, '@claude') || contains(github.event.issue.title, '@claude')))
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write
      id-token: write
      actions: read # Required for Claude to read CI results on PRs
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 1

      - name: Run Claude Code
        id: claude
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            ì´ Pull Requestì˜ ì½”ë“œë¥¼ ìƒì„¸íˆ ë¦¬ë·°í•´ì£¼ì„¸ìš”.

            ## ë¦¬ë·° í¬ì»¤ìŠ¤

            ### 1. ì•„í‚¤í…ì²˜ ì›ì¹™ âš™ï¸
            - Clean Architecture ê³„ì¸µ ë¶„ë¦¬ í™•ì¸ (domain, application, infrastructure, presentation)
            - Domain-Driven Design íŒ¨í„´ ì¤€ìˆ˜ ì—¬ë¶€
            - ë„ë©”ì¸ ëª¨ë¸ê³¼ JPA ì—”í‹°í‹°ê°€ ë¶„ë¦¬ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            - Repository íŒ¨í„´ì´ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì—ˆëŠ”ì§€

            ### 2. ì½”ë“œ í’ˆì§ˆ âœ¨
            - YAGNI ì›ì¹™ ì¤€ìˆ˜ (ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í•¨ìˆ˜ê°€ ìˆëŠ”ì§€)
            - Kotlin ì½”ë”© ì»¨ë²¤ì…˜ ì¤€ìˆ˜
            - null safetyê°€ ì ì ˆíˆ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€
            - ì½”ë“œ ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ì„±
            - ë„¤ì´ë°ì´ ëª…í™•í•œì§€

            ### 3. ë³´ì•ˆ ğŸ”’
            - SQL Injection ì·¨ì•½ì  í™•ì¸
            - XSS (Cross-Site Scripting) ì·¨ì•½ì 
            - ì¸ì¦/ì¸ê°€ ë¡œì§ì˜ ì •í™•ì„±
            - ë¯¼ê° ì •ë³´ ë…¸ì¶œ ì—¬ë¶€
            - Spring Security ì„¤ì • ì˜¤ë¥˜

            ### 4. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ğŸ’¼
            - ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì´ ë„ë©”ì¸ ëª¨ë¸ì— ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì—ˆëŠ”ì§€
            - ì˜ˆì™¸ ì²˜ë¦¬ê°€ ì ì ˆí•œì§€
            - íŠ¸ëœì­ì…˜ ê´€ë¦¬ê°€ ì˜¬ë°”ë¥¸ì§€
            - ë„ë©”ì¸ ì´ë²¤íŠ¸ê°€ í•„ìš”í•œ ê³³ì—ì„œ ì‚¬ìš©ë˜ëŠ”ì§€

            ### 5. í…ŒìŠ¤íŠ¸ ğŸ§ª
            - ì¤‘ìš”í•œ ë¡œì§ì— í…ŒìŠ¤íŠ¸ê°€ ìˆëŠ”ì§€
            - í…ŒìŠ¤íŠ¸ê°€ ì˜ë¯¸ ìˆëŠ”ì§€
            - Given-When-Then íŒ¨í„´ì„ ë”°ë¥´ëŠ”ì§€
            - ê²°ê³¼ ì¤‘ì‹¬ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ëŠ”ì§€ (êµ¬í˜„ ì„¸ë¶€ì‚¬í•­ í…ŒìŠ¤íŠ¸ ì§€ì–‘)

            ## ë¦¬ë·° í˜•ì‹

            ê° íŒŒì¼ë³„ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë¦¬ë·°í•´ì£¼ì„¸ìš”:

            **íŒŒì¼ëª…**: `src/main/kotlin/...`

            âš ï¸ **ì¤‘ìš”í•œ ë¬¸ì œ**: [ë¬¸ì œ ì„¤ëª… ë° ìˆ˜ì • ì œì•ˆ]
            ğŸ’¡ **ê°œì„  ì œì•ˆ**: [ê°œì„  ë°©ë²•]
            âœ… **ì¢‹ì€ ì **: [ì¹­ì°¬í•  ë§Œí•œ ë¶€ë¶„]

            ë§ˆì§€ë§‰ì— ì „ì²´ ìš”ì•½ì„ ì‘ì„±í•´ì£¼ì„¸ìš”:
            - ì£¼ìš” ë³€ê²½ì‚¬í•­
            - ë°œê²¬ëœ ë¬¸ì œì 
            - ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„
            - ì „ë°˜ì ì¸ ì½”ë“œ í’ˆì§ˆ í‰ê°€

            í•œêµ­ì–´ë¡œ ëª…í™•í•˜ê³  ì¹œì ˆí•˜ê²Œ ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.
          claude_args: |
            --max-turns 15
            --model claude-sonnet-4-5-20250929